"""
Standalone podcast seeder that bypasses create_app() to avoid .env encoding issues
"""
import os
import sys
from datetime import datetime
from sqlalchemy import create_engine
from sqlalchemy.orm import sessionmaker

# Add parent directory to path
sys.path.insert(0, os.path.dirname(os.path.abspath(__file__)))

from app.models.content import EducationalContent

# Direct database URL (bypassing .env file)
DATABASE_URL = "postgresql://postgres:12345678@127.0.0.1:5432/sai"

# Podcast metadata
PODCAST_METADATA = [
    {
        'title': 'فهم إدمان التدخين',
        'subtitle': 'تعرف على العلم وراء إدمان النيكوتين وكيف يؤثر على دماغك',
        'content_text': '''
مرحباً بكم في الحلقة الأولى من بودكاست "ساي" للإقلاع عن التدخين.

**ما هو إدمان النيكوتين؟**

النيكوتين هو مادة كيميائية موجودة في التبغ تسبب الإدمان بشكل سريع. عندما تدخن سيجارة، يصل النيكوتين إلى دماغك في غضون 10 ثوانٍ فقط.

**كيف يؤثر على دماغك؟**

يحفز النيكوتين إفراز الدوبامين، وهو ناقل عصبي مرتبط بالمتعة والمكافأة. هذا يخلق شعوراً بالراحة والسعادة المؤقتة، مما يجعلك تريد تكرار التجربة.

**دائرة الإدمان**

مع مرور الوقت، يعتاد دماغك على مستويات عالية من النيكوتين. عندما تنخفض هذه المستويات، تظهر أعراض الانسحاب مثل:
- العصبية والتوتر
- صعوبة التركيز
- الرغبة الشديدة في التدخين
- الأرق

**الخبر السار**

فهم آلية الإدمان هو الخطوة الأولى للتحرر منه. دماغك قابل للتكيف، ويمكنه التعافي من إدمان النيكوتين خلال أسابيع من التوقف عن التدخين.

في الحلقة القادمة، سنتحدث عن الاستراتيجيات العملية للإقلاع عن التدخين.
        ''',
        'reading_time': 15,
        'content_url': 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3'
    },
    {
        'title': 'خطوات الإقلاع عن التدخين',
        'subtitle': 'استراتيجيات عملية وخطوات واضحة للإقلاع النهائي',
        'content_text': '''
مرحباً بكم في الحلقة الثانية - خطوات الإقلاع عن التدخين.

**الخطوة الأولى: حدد يوم الإقلاع**

اختر تاريخاً محدداً خلال الأسبوعين القادمين. تجنب الأوقات المجهدة مثل فترات الامتحانات أو ضغوط العمل.

**الخطوة الثانية: أخبر من حولك**

شارك قرارك مع العائلة والأصدقاء. الدعم الاجتماعي يزيد من فرص نجاحك بنسبة 70%.

**الخطوة الثالثة: حدد محفزاتك**

اكتب قائمة بالمواقف التي تجعلك تريد التدخين:
- بعد القهوة
- في استراحة العمل
- عند الشعور بالتوتر
- مع أصدقاء معينين

**الخطوة الرابعة: خطط للبدائل**

لكل محفز، حدد بديلاً صحياً:
- امضغ علكة خالية من السكر
- تمشى لمدة 5 دقائق
- مارس تمارين التنفس العميق
- اشرب الماء

**الخطوة الخامسة: تخلص من جميع أدوات التدخين**

في يوم الإقلاع، تخلص من:
- جميع السجائر
- الولاعات
- منافض السجائر
- أي شيء يذكرك بالتدخين

**الخطوة السادسة: استخدم وسائل المساعدة**

فكر في استخدام:
- لصقات النيكوتين
- علكة النيكوتين
- تطبيقات تتبع الإقلاع (مثل ساي!)
- الاستشارة النفسية

**تذكر**: معظم المحاولات الناجحة تتطلب أكثر من محاولة واحدة. لا تستسلم!
        ''',
        'reading_time': 20,
        'content_url': 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3'
    },
    {
        'title': 'التعامل مع أعراض الانسحاب',
        'subtitle': 'كيف تدير الرغبة الشديدة وأعراض انسحاب النيكوتين',
        'content_text': '''
مرحباً بكم في الحلقة الثالثة - التعامل مع أعراض الانسحاب.

**فهم أعراض الانسحاب**

أعراض انسحاب النيكوتين تبدأ خلال ساعات من آخر سيجارة وتصل لذروتها في اليوم 2-3. الخبر السار؟ معظم الأعراض تختفي خلال أسبوعين.

**الأعراض الشائعة وكيفية التعامل معها:**

**1. الرغبة الشديدة في التدخين**
- تستمر 3-5 دقائق فقط
- استخدم قاعدة "الـ 5 دقائق": انتظر 5 دقائق، والرغبة ستمر
- شتت انتباهك بنشاط آخر

**2. العصبية والتوتر**
- مارس تمارين التنفس العميق
- احصل على قسط كافٍ من النوم
- تجنب الكافيين الزائد
- مارس الرياضة بانتظام

**3. صعوبة التركيز**
- خذ فترات راحة قصيرة ومتكررة
- قسّم المهام الكبيرة إلى أجزاء صغيرة
- اشرب الكثير من الماء
- هذا مؤقت - سيتحسن خلال أسبوعين

**4. زيادة الشهية**
- احتفظ بوجبات خفيفة صحية (فواكه، خضروات)
- اشرب الماء عند الشعور بالجوع
- تناول وجبات منتظمة
- مارس الرياضة للسيطرة على الوزن

**5. الأرق**
- تجنب الكافيين بعد الظهر
- حافظ على جدول نوم منتظم
- مارس الاسترخاء قبل النوم
- تجنب الشاشات قبل النوم بساعة

**تقنية "الـ 4 D's" لمقاومة الرغبة:**

1. **Delay** (أجّل): انتظر 5-10 دقائق
2. **Deep breathe** (تنفس عميقاً): خذ 10 أنفاس عميقة
3. **Drink water** (اشرب الماء): كوب كامل من الماء
4. **Do something else** (افعل شيئاً آخر): غيّر نشاطك

**تذكر**: الأعراض مؤقتة، لكن فوائد الإقلاع دائمة!
        ''',
        'reading_time': 18,
        'content_url': 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3'
    },
    {
        'title': 'قصص نجاح ملهمة',
        'subtitle': 'استمع لتجارب أشخاص نجحوا في الإقلاع عن التدخين',
        'content_text': '''
مرحباً بكم في الحلقة الرابعة - قصص نجاح ملهمة.

**قصة أحمد - 20 سنة من التدخين**

"بدأت التدخين في سن 18. بعد 20 سنة، كنت أدخن علبتين يومياً. حاولت الإقلاع 5 مرات وفشلت. في المرة السادسة، استخدمت تطبيق ساي وانضممت لمجموعة دعم. اليوم، مضى عامان بدون تدخين!"

**ما ساعد أحمد:**
- تتبع التقدم يومياً
- الدعم من المجموعة
- رؤية المبلغ المالي الذي وفره
- ملاحظة تحسن صحته

**قصة سارة - التدخين أثناء الحمل**

"اكتشفت أني حامل وكنت أدخن نصف علبة يومياً. الخوف على طفلي كان الدافع الأكبر. توقفت فوراً، رغم صعوبة الأمر. ابني الآن عمره 5 سنوات ولم أعد للتدخين أبداً."

**ما ساعد سارة:**
- دافع قوي وواضح (صحة الطفل)
- دعم الزوج والعائلة
- المتابعة الطبية المنتظمة
- تذكير نفسها يومياً بالسبب

**قصة محمد - الإقلاع بعد أزمة قلبية**

"في سن 45، أصبت بأزمة قلبية خفيفة. الطبيب قال: 'إما أن تتوقف عن التدخين أو ستموت مبكراً.' كانت رسالة صادمة لكنها أنقذت حياتي. مضى 7 سنوات الآن."

**ما ساعد محمد:**
- إدراك خطورة الموقف
- استخدام لصقات النيكوتين
- ممارسة المشي يومياً
- تجنب الأماكن والأشخاص المرتبطين بالتدخين

**قصة فاطمة - الإقلاع في سن الشباب**

"دخنت لمدة 3 سنوات فقط، لكن أصبحت مدمنة. قررت التوقف عندما لاحظت أن رائحتي كريهة وأسناني تتغير لونها. استغرق الأمر شهرين، لكني نجحت!"

**ما ساعد فاطمة:**
- التوقف المبكر قبل تعمق الإدمان
- العناية بالمظهر كحافز
- استبدال التدخين بالرياضة
- دعم الصديقات

**الدروس المشتركة من جميع القصص:**

1. **المحاولات المتعددة طبيعية** - لا تستسلم!
2. **الدافع القوي ضروري** - لماذا تريد الإقلاع؟
3. **الدعم الاجتماعي مهم** - لا تفعلها وحدك
4. **التخطيط والأدوات تساعد** - استخدم كل ما هو متاح
5. **الفوائد تظهر سريعاً** - ستشعر بالفرق خلال أيام

**رسالة أخيرة:**

إذا نجح هؤلاء، يمكنك أنت أيضاً! قصتك التالية يمكن أن تكون مصدر إلهام للآخرين.
        ''',
        'reading_time': 25,
        'content_url': 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-4.mp3'
    },
    {
        'title': 'الفوائد الصحية للإقلاع',
        'subtitle': 'ماذا يحدث لجسمك بعد التوقف عن التدخين',
        'content_text': '''
مرحباً بكم في الحلقة الخامسة - الفوائد الصحية للإقلاع.

**الجدول الزمني للتعافي - ما يحدث لجسمك:**

**بعد 20 دقيقة:**
- ينخفض معدل ضربات القلب وضغط الدم
- تبدأ الدورة الدموية في التحسن

**بعد 8 ساعات:**
- ينخفض مستوى أول أكسيد الكربون في الدم
- يرتفع مستوى الأكسجين إلى المعدل الطبيعي

**بعد 24 ساعة:**
- يبدأ خطر الإصابة بنوبة قلبية في الانخفاض

**بعد 48 ساعة:**
- تبدأ النهايات العصبية في التجدد
- تتحسن حاسة الشم والتذوق

**بعد 72 ساعة:**
- تتحسن وظيفة الرئة
- يصبح التنفس أسهل
- يزداد مستوى الطاقة

**بعد أسبوعين إلى 3 أشهر:**
- تتحسن الدورة الدموية بشكل كبير
- تصبح ممارسة الرياضة أسهل
- تتحسن وظائف الرئة بنسبة 30%

**بعد 1-9 أشهر:**
- يقل السعال وضيق التنفس
- تزداد طاقتك بشكل ملحوظ
- تتجدد الأهداب في الرئتين (تنظف الرئتين بشكل أفضل)

**بعد سنة واحدة:**
- ينخفض خطر الإصابة بأمراض القلب بنسبة 50%

**بعد 5 سنوات:**
- ينخفض خطر الإصابة بالسكتة الدماغية إلى مستوى غير المدخنين
- ينخفض خطر الإصابة بسرطان الفم والحلق والمريء بنسبة 50%

**بعد 10 سنوات:**
- ينخفض خطر الإصابة بسرطان الرئة إلى نصف خطر المدخن
- ينخفض خطر الإصابة بسرطان المثانة والكلى والبنكرياس

**بعد 15 سنة:**
- يصبح خطر الإصابة بأمراض القلب مماثلاً لغير المدخنين تماماً

**الفوائد الإضافية:**

**الفوائد المالية:**
- إذا كنت تدخن علبة يومياً بـ400 دينار، ستوفر 146,000 دينار سنوياً!

**الفوائد الجمالية:**
- بشرة أكثر نضارة
- أسنان أكثر بياضاً
- رائحة أفضل للفم والملابس والمنزل

**الفوائد الاجتماعية:**
- قدوة إيجابية لأطفالك
- عدم إزعاج الآخرين بالدخان
- قبول اجتماعي أكبر

**الفوائد النفسية:**
- شعور بالإنجاز والفخر
- ثقة أكبر بالنفس
- أقل توتراً (رغم أن التدخين يبدو مهدئاً، فهو يزيد التوتر على المدى الطويل)

**رسالة ختامية:**

جسمك يبدأ بالتعافي فوراً، حتى لو كنت تدخن لعقود. لم يفت الأوان أبداً للإقلاع!

كل يوم بدون تدخين هو استثمار في صحتك ومستقبلك. ابدأ اليوم!
        ''',
        'reading_time': 12,
        'content_url': 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-5.mp3'
    }
]

def seed_podcasts():
    """Seed podcasts directly without using create_app()"""
    print("Connecting to database...")
    
    # Create engine and session
    engine = create_engine(DATABASE_URL)
    Session = sessionmaker(bind=engine)
    session = Session()
    
    try:
        # Check if podcasts already exist
        existing_count = session.query(EducationalContent).filter_by(category='podcasts').count()
        if existing_count > 0:
            print(f"✅ Podcasts already exist ({existing_count} items). Skipping seed.")
            return
        
        # Add podcasts
        print("Adding podcasts...")
        for metadata in PODCAST_METADATA:
            podcast = EducationalContent(
                title=metadata['title'],
                content_type='podcast',
                content_url=metadata['content_url'],
                content_text=metadata['content_text'],
                category='podcasts',
                language='ar-dz',
                reading_time=metadata['reading_time'],
                is_published=True,
                created_at=datetime.utcnow(),
                updated_at=datetime.utcnow()
            )
            session.add(podcast)
            print(f"  ✓ {metadata['title']}")
        
        # Commit changes
        session.commit()
        print(f"\n✅ Successfully seeded {len(PODCAST_METADATA)} podcasts!")
        
    except Exception as e:
        session.rollback()
        print(f"❌ Error: {e}")
        raise
    finally:
        session.close()

if __name__ == "__main__":
    seed_podcasts()
